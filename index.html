<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ –£–≥–∞–¥–∞–π –∂–∏–≤–æ—Ç–Ω–æ–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        :root {
            --primary: #4a90e2;
            --success: #2ed573;
            --danger: #ff4757;
            --bg-color: #d7dffb;
        }

        body {
            font-family: 'Comfortaa', cursive;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            text-align: center;
            margin: 0;
            padding: 0;
            color: #2c3e50;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .screen {
            display: none;
            padding: 15px;
            width: 100%;
            max-width: 800px;
            margin: auto;
            box-sizing: border-box;
            flex-grow: 1;
        }

        .active {
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center;
            animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        button {
            padding: 14px 28px;
            margin: 8px;
            font-size: 18px;
            font-weight: 900;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            background: #4a90e2;
            color: white;
            box-shadow: 0 6px 0 #2e66a3;
            transition: 0.1s;
            text-transform: uppercase;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #2e66a3;
        }

        #soundBtn {
            background: #ff7f50;
            box-shadow: 0 6px 0 #d35400;
            width: 50%;
            height: 40px;
            max-width: 320px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; 
            align-items: center;
            background: white;
            padding: 12px 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.05);
            font-weight: 900;
            width: 100%;
            max-width: 550px;
            box-sizing: border-box;
        }

        .level-badge {
            background: #f1c40f;
            padding: 6px 12px;
            border-radius: 12px;
            color: white;
            font-size: 0.9rem;
            display: inline-block;
        }

        #timer { 
            color: var(--danger); 
            background: #fff5f5;
            padding: 5px 15px;
            border-radius: 15px;
            border: 2px solid #ffebeb;
            font-size: 1rem;
            font-weight: 900;
        }

        .grid {
            display: grid;
            gap: 15px;
            margin: 0 auto 30px auto;
            width: 100%;
            max-width: 550px;
            justify-content: center;
        }

        .card {
            background: white;
            border: 4px solid #f0f0f0;
            border-radius: 25px;
            padding: 0;
            cursor: pointer;
            box-shadow: 0 10px 0 #e0e0e0;
            transition: transform 0.2s, box-shadow 0.2s;
            animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards;
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1; 
            overflow: hidden;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block;
        }

        .card.wrong {
            border-color: var(--danger) !important;
            animation: shake 0.4s;
            box-shadow: 0 10px 0 #cf3544;
        }

        .card.correct {
            border-color: var(--success) !important;
            box-shadow: 0 10px 0 #1e9a50;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(44, 62, 80, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.active { display: flex; }

        .modal-box {
            background: white;
            padding: 35px;
            border-radius: 40px;
            width: 100%;
            max-width: 420px;
            border: 8px solid var(--primary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div id="menu" class="screen active">
    <div style="font-size: 50px; margin-bottom: 10px;">üêæ</div>
    <h1 style="font-size: 3rem; margin: 0;">–£–≥–∞–¥–∞–π–∫–∞!</h1>
    <div class="text-6xl mb-0 animate-bounce">ü¶Å</div>
    <p style="color: #5d6d7e; margin-bottom: 30px; font-size: 1.2rem;">–°–ª—É—à–∞–π –∑–≤—É–∫ –∏ –Ω–∞—Ö–æ–¥–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ!</p>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 w-full max-w-2xl px-4">
        <div class="bg-white p-4 rounded-3xl shadow-xl text-center">
            <p class="text-[10px] text-gray-400 uppercase font-black">–†–µ–∫–æ—Ä–¥ –æ—á–∫–æ–≤</p>
            <p id="highScore" class="text-2xl font-black text-orange-500">‚≠ê 0</p>
        </div>
        <div class="bg-white p-4 rounded-3xl shadow-xl text-center">
            <p class="text-[10px] text-gray-400 uppercase font-black">–õ—É—á—à–∏–π —É—Ä–æ–≤–µ–Ω—å</p>
            <p id="highLevel" class="text-2xl font-black text-blue-500">üèÜ 1</p>
        </div>
        <div class="bg-white p-4 rounded-3xl shadow-xl text-center">
            <p class="text-[10px] text-gray-400 uppercase font-black">–†–µ–∞–∫—Ü–∏—è</p>
            <p id="bestTime" class="text-2xl font-black text-green-500">‚ö° --</p>
        </div>
    </div>
    
    <button id="playBtn" style="width: 250px; font-size: 24px; background: #4a90e2;">–ò–ì–†–ê–¢–¨</button>
    <br>
    <button id="exitBtn" style="background: #95a5a6; box-shadow: 0 6px 0 #7f8c8d; font-size: 14px; padding: 7px;">–í–´–•–û–î</button>
</div>

<div id="game" class="screen">
    <div class="flex justify-between w-full max-w-[600px] mb-4">
        <div id="livesDisplay" class="text-3xl">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <button id="pauseBtn" class="bg-white/50 p-2 rounded-xl hover:bg-blue-400 font-bold">‚è∏</button>
    </div>

    <div class="stats-bar">
        <div class="level-side"><span class="level-badge" id="levelLabel">–£—Ä. 1</span></div>
        <div class="timer-side"><div id="timer">‚è± 00:20</div></div>
        <div class="score-side"><div id="score">‚≠ê 0</div></div>
    </div>

    <button id="soundBtn"><span>üîä –°–õ–£–®–ê–¢–¨</span></button>
    <div id="grid" class="grid"></div>
    <button id="backBtn" style="width: 30%; background: #95a5a6; box-shadow: 0 6px 0 #7f8c8d; font-size: 14px; margin-top: 10px;">üè† –í –º–µ–Ω—é</button>
</div>

<div id="modal" class="modal">
    <div class="modal-box">
        <h2 id="modalTitle" style="margin-top: 0; font-size: 2rem;">–ü–∞—É–∑–∞</h2>
        <p id="modalText" style="font-size: 1.3rem; margin-bottom: 25px; white-space: pre-line;"></p>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <button id="modalOk" style="margin: 0; background-color:#4a90e2;">–î–∞–ª—å—à–µ!</button>
            <button id="modalMenu" style="background: #95a5a6; box-shadow: 0 6px 0 #7f8c8d; margin: 0;">–í—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
        </div>
    </div>
</div>

<script>
/* ================= –î–ê–ù–ù–´–ï –° –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò ================= */
const animals = [
    // –õ–µ–≥–∫–∏–µ: –î–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ, –Ω–∞—Å–µ–∫–æ–º—ã–µ –∏ –ø—Ç–∏—Ü—ã (–£—Ä–æ–≤–Ω–∏ 1-10)
    {name:"–ö–æ—à–∫–∞", img:"koshka.webp", sound:"koshka.mp3", cat: "easy"},
    {name:"–°–æ–±–∞–∫–∞", img:"sobaka.jpg", sound:"sobaka.mp3", cat: "easy"},
    {name:"–ü–µ—Ç—É—Ö", img:"petuh.jpg", sound:"petuha.mp3", cat: "easy"},
    {name:"–°–≤–∏–Ω—å—è", img:"svinia.jpg", sound:"svinia.mp3", cat: "easy"},
    {name:"–û—Å–µ–ª", img:"osel.jpg", sound:"osel.mp3", cat: "easy"},
    {name:"–ë–∞—Ä–∞–Ω", img:"baran.jpg", sound:"baran.mp3", cat: "easy"},
    {name:"–ö–æ—Ä–æ–≤–∞", img:"korova.webp", sound:"korova.mp3", cat: "easy"},
    {name:"–ü—á–µ–ª–∞", img:"shmelja.jpeg", sound:"shmelja.mp3", cat: "easy"},
    {name:"–ì—É—Å—å", img:"guse.jpg", sound:"guse.mp3", cat: "easy"},
    {name:"–ö—É—Ä–∏—Ü–∞", img:"kuriza.webp", sound:"kuriza.mp3", cat: "easy"},
    {name:"–õ–æ—à–∞–¥—å", img:"loshad.jpg", sound:"loshad.mp3", cat: "easy"},
    {name:"–ú—É—Ö–∞", img:"mucha.webp", sound:"mucha.mp3", cat: "easy"},
    {name:"–í–æ—Ä–æ–Ω–∞", img:"vorona.jpg", sound:"vorona.mp3", cat: "easy"},
    {name:"–°–ª–æ–Ω", img:"slon.avif", sound:"slon.mp3", cat: "easy"},
    {name:"–û–±–µ–∑—å—è–Ω–∞", img:"obeziana.avif", sound:"obeziana.mp3", cat: "easy"},
    {name:"–ó–º–µ—è", img:"smeja.avif", sound:"smeja.mp3", cat: "easy"},
    {name:"–°–æ–≤–∞", img:"sova.jpg", sound:"sova.mp3", cat: "easy"},
    {name:"–õ—è–≥—É—à–∫–∞", img:"liagushka.jpg", sound:"liagushka.mp3", cat: "easy"},
    {name:"–ú—ã—à–∫–∞", img:"myshka.jpg", sound:"myshka.mp3", cat: "easy"},
    {name:"–õ–µ–≤", img:"lev.jpg", sound:"lev.mp3", cat: "easy"},
    {name:"–í–æ–ª–∫", img:"volk.jpg", sound:"volk.mp3", cat: "easy"},
    {name:"–ó–º–µ—è", img:"smeja.avif", sound:"smeja.mp3", cat: "easy"},
    {name:"–°–∞—Ä–∞–Ω—á–∞", img:"sarancha.webp", sound:"sarancha.mp3", cat: "easy"},
    {name:"–î–µ–ª—å—Ñ–∏–Ω", img:"dolphin.jpg", sound:"dolphin.mp3", cat: "easy"},
    {name:"–ò–Ω–¥—é–∫", img:"induk.jpg", sound:"induk.mp3", cat: "easy"},
    {name:"–ü—á–µ–ª–∞", img:"pchela.png", sound:"pchela.mp3", cat: "easy"},
    // –°—Ä–µ–¥–Ω–∏–µ: –î–∏–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –∏ –ø—Ç–∏—Ü—ã —Å–æ –∑–≤—É–∫–∞–º–∏ (–£—Ä–æ–≤–Ω–∏ 11-20)
    {name:"–¢–∏–≥—Ä", img:"tigr.jpg", sound:"tigr.mp3", cat: "medium"},
    {name:"–Ø–≥—É–∞—Ä", img:"jaguer.jpg", sound:"jaguer.mp3", cat: "medium"},
    {name:"–ú–µ–¥–≤–µ–¥—å", img:"medved.webp", sound:"medved.mp3", cat: "medium"},
    {name:"–ì–æ–ª—É–±—å", img:"golubya.jpg", sound:"golubya.mp3", cat: "medium"},
    {name:"–•–æ–º—è–∫", img:"homyak.webp", sound:"homyak.mp3", cat: "medium"},
    {name:"–ö–æ–∑–∞", img:"koza.jpg", sound:"koza.mp3", cat: "medium"},
    {name:"–°–æ—Ä–æ–∫–∞", img:"soroki.jpg", sound:"soroki.mp3", cat: "medium"},
    {name:"–î—è—Ç–µ–ª", img:"datel.avif", sound:"datel.mp3", cat: "medium"},
    {name:"–ë—ã–∫", img:"byk.jpg", sound:"byk.mp3", cat: "medium"},
    {name:"–õ–∏—Å–∞", img:"lisa.webp", sound:"lisa.mp3", cat: "medium"},
    {name:"–ó–∞—è—Ü", img:"zayas.jpg", sound:"zayas.mp3", cat: "medium"},
    {name:"–ë–µ–ª–∫–∞", img:"belka.jpg", sound:"belka.mp3", cat: "medium"},
    {name:"–°—Ç—Ä–∞—É—Å", img:"straus.jpg", sound:"straus.mp3", cat: "easy"},
    {name:"–í–µ—Ä–±–ª—é–¥", img:"verblud.webp", sound:"verblud.mp3", cat: "medium"},
    // –°–ª–æ–∂–Ω—ã–µ: –†–µ–¥–∫–∏–µ –∑–≤—É–∫–∏ –∏ —Å–º–µ—Å—å (–£—Ä–æ–≤–Ω–∏ 21-30)
    {name:"–ö–∏—Ç", img:"kit.avif", sound:"kita.mp3", cat: "hard"},
    {name:"–û–ª–µ–Ω—å", img:"olen.jpg", sound:"olen.mp3", cat: "hard"},
    {name:"–ë–æ–≥–æ–º–æ–ª", img:"bogomol.jpg", sound:"bogomol.mp3", cat: "hard"},
    {name:"–ü–∞–≤–ª–∏–Ω", img:"pavlin.webp", sound:"pavlin.mp3", cat: "hard"},
    {name:"–ü–∏–Ω–≥–≤–∏–Ω", img:"pingvin.jpg", sound:"pingvin.mp3", cat: "hard"},
    {name:"–ú–æ—à–∫–∞", img:"moshka.jpg", sound:"moshka.mp3", cat: "hard"},
    {name:"–ó–µ–±—Ä–∞", img:"zebra.jpg", sound:"zebra.mp3", cat: "hard"},
    {name:"–ü–∞–Ω–¥–∞", img:"panda.jpg", sound:"panda.mp3", cat: "hard"},
    {name:"–ü–∞–Ω—Ç–µ—Ä–∞", img:"pantera.webp", sound:"pantera.mp3", cat: "hard"},
    {name:"–ö—Ä–æ–∫–æ–¥–∏–ª", img:"krokodil.jpg", sound:"krokodil.mp3", cat: "hard"},
    {name:"–ö–∞–ø–∏–±–∞—Ä–∞", img:"kapibara.jpg", sound:"kapibara.mp3", cat: "hard"},
    {name:"–ö–∞–±–∞–Ω", img:"kaban.jpg", sound:"kaban.mp3", cat: "hard"},
    {name:"–ï–∂", img:"ej.jpeg", sound:"ej.mp3", cat: "hard"}
];

/* ================= –°–û–°–¢–û–Ø–ù–ò–ï ================= */
let score = 0;
let lives = 3;
let level = 1;
const MAX_LEVELS = 30;
let timeLeft = 25;
let correctAnimal;
let currentAudio = null;
let timerInterval = null;
let isProcessing = false;
let isPaused = false;
let roundStartTime = 0;

// –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —á–∞—Å—Ç—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤
// –•—Ä–∞–Ω–∏–º –∏–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5-6 –∂–∏–≤–æ—Ç–Ω—ã—Ö, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
let recentCorrectAnimals = [];

let highScore = parseInt(localStorage.getItem('guess_highScore')) || 0;
let highLevel = parseInt(localStorage.getItem('guess_highLevel')) || 1;
let bestTime = localStorage.getItem('guess_bestTime') ? parseFloat(localStorage.getItem('guess_bestTime')) : null;

const grid = document.getElementById("grid");
const livesDisplay = document.getElementById("livesDisplay");
const scoreDiv = document.getElementById("score");
const levelLabel = document.getElementById("levelLabel");
const timerDisplay = document.getElementById("timer");

function updateStats(){
    scoreDiv.textContent = "‚≠ê " + score;
    livesDisplay.textContent = "‚ù§Ô∏è".repeat(lives);
    levelLabel.textContent = "–£—Ä." + level;
}

function updateMenuRecords() {
    document.getElementById("highScore").textContent = "‚≠ê " + highScore;
    document.getElementById("highLevel").textContent = "üèÜ " + highLevel;
    document.getElementById("bestTime").textContent = bestTime ? "‚ö° " + bestTime + "—Å" : "‚ö° --";
}

function saveRecords() {
    if (score > highScore) { highScore = score; localStorage.setItem('guess_highScore', highScore); }
    if (level > highLevel) { highLevel = level; localStorage.setItem('guess_highLevel', highLevel); }
}

function showModal(title, text, okLabel, okAction){
    document.getElementById("modalTitle").textContent = title;
    document.getElementById("modalText").textContent = text;
    document.getElementById("modalOk").textContent = okLabel;
    document.getElementById("modal").classList.add("active");
    
    document.getElementById("modalOk").onclick = () => {
        document.getElementById("modal").classList.remove("active");
        if(okAction) okAction();
    };
    document.getElementById("modalMenu").onclick = exitToMenu;
}

function startTimer() {
    stopTimer();
    timerInterval = setInterval(() => {
        if(!isPaused) {
            timeLeft--;
            let min = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            let sec = String(timeLeft % 60).padStart(2, '0');
            timerDisplay.textContent = `‚è± ${min}:${sec}`;
            if (timeLeft <= 0) {
                stopTimer();
                saveRecords();
                showModal("–í—Ä–µ–º—è –≤—ã—à–ª–æ!", `–¢–≤–æ–π —Å—á–µ—Ç: ${score}`, "–ó–∞–Ω–æ–≤–æ", restartGame);
            }
        }
    }, 1000);
}

function stopTimer() { if(timerInterval) clearInterval(timerInterval); }

function togglePause() {
    if(isProcessing || isPaused) return; 
    isPaused = true;
    if(currentAudio) currentAudio.pause();
    showModal("–ü–∞—É–∑–∞", "–ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?", "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", () => { isPaused = false; });
}

function playSound(){
    if(!correctAnimal || isPaused) return;
    if(currentAudio){ currentAudio.pause(); currentAudio.currentTime = 0; }
    currentAudio = new Audio(correctAnimal.sound);
    currentAudio.play().catch(() => {});
}

function newRound(){
    isProcessing = false;
    isPaused = false;
    
    // –õ–æ–≥–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (–°–±—Ä–æ—Å –∫–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π)
    let cycleLevel = (level - 1) % 10 + 1;
    let cardCount;
    if (cycleLevel <= 3) {
        cardCount = 2;
        grid.style.gridTemplateColumns = "repeat(2, 1fr)";
    } else if (cycleLevel <= 7) {
        cardCount = 4;
        grid.style.gridTemplateColumns = "repeat(2, 1fr)";
    } else {
        cardCount = 9;
        grid.style.gridTemplateColumns = "repeat(3, 1fr)";
    }

    // –í—ã–±–æ—Ä –ø—É–ª–∞ –∂–∏–≤–æ—Ç–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    let pool;
    if (level <= 10) pool = animals.filter(a => a.cat === "easy");
    else if (level <= 20) pool = animals.filter(a => a.cat === "medium");
    else pool = animals.filter(a => a.cat === "hard" || a.cat === "medium");

    // --- –£–õ–£–ß–®–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ù–î–û–ú–ê (–ë–ï–ó –ü–û–í–¢–û–†–û–í) ---
    // –ò—Å–∫–ª—é—á–∞–µ–º –∏–∑ –≤—ã–±–æ—Ä–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ü–†–ê–í–ò–õ–¨–ù–û–ì–û —Ç–µ—Ö, –∫—Ç–æ –±—ã–ª –Ω–µ–¥–∞–≤–Ω–æ
    // –û—Å—Ç–∞–≤–ª—è–µ–º —Ö–æ—Ç—è –±—ã 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ –ø—É–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –¥–ª–∏–Ω–Ω–∞—è
    let availableForCorrect = pool.filter(a => !recentCorrectAnimals.includes(a.name));
    if (availableForCorrect.length < 2) availableForCorrect = pool; 

    // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ
    correctAnimal = availableForCorrect[Math.floor(Math.random() * availableForCorrect.length)];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é (–Ω–µ –±–æ–ª–µ–µ 3 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∑–∞ 3 —É—Ä–æ–≤–Ω—è - –∑–Ω–∞—á–∏—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ—Ä–∂–∏–º —Å—Ç–æ–ª—å–∫–æ –∏–º–µ–Ω, 
    // —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å —á–∞—Å—Ç—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ)
    recentCorrectAnimals.push(correctAnimal.name);
    if (recentCorrectAnimals.length > 6) {
        recentCorrectAnimals.shift();
    }

    // –°–æ–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Ä–∞—É–Ω–¥–∞
    let roundAnimals = [correctAnimal];
    let otherOptions = pool.filter(a => a.name !== correctAnimal.name).sort(() => Math.random() - 0.5);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    for (let i = 0; i < cardCount - 1; i++) {
        if (otherOptions[i]) {
            roundAnimals.push(otherOptions[i]);
        } else {
            // –ï—Å–ª–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–≤–æ—Ç–Ω—ã–µ, –±–µ—Ä–µ–º –∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            let fallback = animals.filter(a => !roundAnimals.includes(a)).sort(() => Math.random() - 0.5);
            roundAnimals.push(fallback[0]);
        }
    }

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç–æ–ª–µ
    roundAnimals.sort(() => Math.random() - 0.5);

    grid.innerHTML = "";
    roundAnimals.forEach((a, index) => {
        const card = document.createElement("div");
        card.className = "card";
        card.style.animationDelay = (index * 0.05) + "s";
        const img = document.createElement("img");
        img.src = a.img;
        card.appendChild(img);
        card.onclick = () => checkAnswer(a, card);
        grid.appendChild(card);
    });
    
    setTimeout(() => { playSound(); roundStartTime = Date.now(); }, 600);
}

function checkAnswer(animal, cardElement){
    if(isProcessing || isPaused) return;

    if(animal.name === correctAnimal.name){
        isProcessing = true;
        cardElement.classList.add('correct');
        
        const reactionTime = parseFloat(((Date.now() - roundStartTime) / 1000).toFixed(2));
        if (bestTime === null || reactionTime < bestTime) {
            bestTime = reactionTime;
            localStorage.setItem('guess_bestTime', bestTime);
        }

        score += 10;
        
        // –ö–∞–∂–¥—ã–µ 30 –æ—á–∫–æ–≤ - –ø–µ—Ä–µ—Ö–æ–¥ —É—Ä–æ–≤–Ω—è
        if (score > 0 && score % 30 === 0) {
            if (level >= MAX_LEVELS) {
                saveRecords();
                showModal("–ì–†–ê–ù–î-–ü–û–ë–ï–î–ê!", `–¢—ã –ø—Ä–æ—à–µ–ª –≤—Å–µ ${MAX_LEVELS} —É—Ä–æ–≤–Ω–µ–π!\n–°—á–µ—Ç: ${score}`, "–ï—â–µ —Ä–∞–∑", restartGame);
                return;
            }
            
            level++;
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º –≤—Ç–æ—Ä–æ–º —É—Ä–æ–≤–Ω–µ
            if (level % 2 === 0 && lives < 5) lives++; 
            
            updateStats();
            setTimeout(() => {
                showModal("–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!", `–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —É—Ä–æ–≤–µ–Ω—å ${level}.\n–ñ–∏–∑–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!`, "–ü–æ–µ—Ö–∞–ª–∏!", () => {
                    timeLeft = 25 + Math.floor(level/2); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è —Å —É—Ä–æ–≤–Ω–µ–º
                    startTimer();
                    newRound();
                });
            }, 500);
        } else {
            updateStats();
            saveRecords();
            setTimeout(newRound, 600);
        }
    } else {
        cardElement.classList.add('wrong');
        lives--;
        score -=10;
        scoreDiv.textContent = "‚≠ê " + score;
        updateStats();
        if(lives <= 0){
            stopTimer();
            saveRecords();
            setTimeout(() => {
                showModal("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞", `–¢—ã –¥–æ—à–µ–ª –¥–æ ${level} —É—Ä–æ–≤–Ω—è.\n–°—á–µ—Ç: ${score}`, "–ó–∞–Ω–æ–≤–æ", restartGame);
            }, 500);
        }
    }
}

function restartGame(){
    score = 0; lives = 3; level = 1; timeLeft = 25; isPaused = false;
    recentCorrectAnimals = []; // –°–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –Ω–æ–≤–æ–π –∏–≥—Ä–µ
    updateStats(); startTimer(); newRound();
}

function exitToMenu(){
    stopTimer(); if(currentAudio) currentAudio.pause();
    isPaused = false; saveRecords(); updateMenuRecords();
    document.getElementById("modal").classList.remove("active");
    document.getElementById("game").classList.remove("active");
    document.getElementById("menu").classList.add("active");
}

document.getElementById("playBtn").onclick = () => {
    document.getElementById("menu").classList.remove("active");
    document.getElementById("game").classList.add("active");
    restartGame();
};

document.getElementById("exitBtn").onclick = () => { if(confirm("–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã?")) window.close(); };
document.getElementById("backBtn").onclick = exitToMenu;
document.getElementById("soundBtn").onclick = playSound;
document.getElementById("pauseBtn").onclick = togglePause;

updateMenuRecords();
</script>
</body>

</html>


